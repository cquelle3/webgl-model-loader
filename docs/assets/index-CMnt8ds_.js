(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();var w=1e-6,P=typeof Float32Array<"u"?Float32Array:Array,z=Math.PI/180;function L(t){return t*z}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function C(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N(t,e,a){var i=a[0],r=a[1],s=a[2],l,h,f,v,g,n,o,m,p,E,c,u;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(l=e[0],h=e[1],f=e[2],v=e[3],g=e[4],n=e[5],o=e[6],m=e[7],p=e[8],E=e[9],c=e[10],u=e[11],t[0]=l,t[1]=h,t[2]=f,t[3]=v,t[4]=g,t[5]=n,t[6]=o,t[7]=m,t[8]=p,t[9]=E,t[10]=c,t[11]=u,t[12]=l*i+g*r+p*s+e[12],t[13]=h*i+n*r+E*s+e[13],t[14]=f*i+o*r+c*s+e[14],t[15]=v*i+m*r+u*s+e[15]),t}function X(t,e,a){var i=Math.sin(a),r=Math.cos(a),s=e[4],l=e[5],h=e[6],f=e[7],v=e[8],g=e[9],n=e[10],o=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+v*i,t[5]=l*r+g*i,t[6]=h*r+n*i,t[7]=f*r+o*i,t[8]=v*r-s*i,t[9]=g*r-l*i,t[10]=n*r-h*i,t[11]=o*r-f*i,t}function W(t,e,a){var i=Math.sin(a),r=Math.cos(a),s=e[0],l=e[1],h=e[2],f=e[3],v=e[8],g=e[9],n=e[10],o=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-v*i,t[1]=l*r-g*i,t[2]=h*r-n*i,t[3]=f*r-o*i,t[8]=s*i+v*r,t[9]=l*i+g*r,t[10]=h*i+n*r,t[11]=f*i+o*r,t}function G(t,e,a){var i=Math.sin(a),r=Math.cos(a),s=e[0],l=e[1],h=e[2],f=e[3],v=e[4],g=e[5],n=e[6],o=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+v*i,t[1]=l*r+g*i,t[2]=h*r+n*i,t[3]=f*r+o*i,t[4]=v*r-s*i,t[5]=g*r-l*i,t[6]=n*r-h*i,t[7]=o*r-f*i,t}function H(t,e,a,i,r){var s=1/Math.tan(e/2),l;return t[0]=s/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(l=1/(i-r),t[10]=(r+i)*l,t[14]=2*r*i*l):(t[10]=-1,t[14]=-2*i),t}var q=H;function V(t,e,a,i){var r,s,l,h,f,v,g,n,o,m,p=e[0],E=e[1],c=e[2],u=i[0],R=i[1],y=i[2],_=a[0],F=a[1],S=a[2];return Math.abs(p-_)<w&&Math.abs(E-F)<w&&Math.abs(c-S)<w?C(t):(g=p-_,n=E-F,o=c-S,m=1/Math.hypot(g,n,o),g*=m,n*=m,o*=m,r=R*o-y*n,s=y*g-u*o,l=u*n-R*g,m=Math.hypot(r,s,l),m?(m=1/m,r*=m,s*=m,l*=m):(r=0,s=0,l=0),h=n*l-o*s,f=o*r-g*l,v=g*s-n*r,m=Math.hypot(h,f,v),m?(m=1/m,h*=m,f*=m,v*=m):(h=0,f=0,v=0),t[0]=r,t[1]=h,t[2]=g,t[3]=0,t[4]=s,t[5]=f,t[6]=n,t[7]=0,t[8]=l,t[9]=v,t[10]=o,t[11]=0,t[12]=-(r*p+s*E+l*c),t[13]=-(h*p+f*E+v*c),t[14]=-(g*p+n*E+o*c),t[15]=1,t)}function T(){var t=new P(3);return P!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function B(t,e,a,i){return t[0]=e,t[1]=a,t[2]=i,t}function O(t,e,a){return t[0]=e[0]-a[0],t[1]=e[1]-a[1],t[2]=e[2]-a[2],t}function k(t,e){var a=e[0],i=e[1],r=e[2],s=a*a+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function K(t,e,a){var i=e[0],r=e[1],s=e[2],l=a[0],h=a[1],f=a[2];return t[0]=r*f-s*h,t[1]=s*l-i*f,t[2]=i*h-r*l,t}(function(){var t=T();return function(e,a,i,r,s,l){var h,f;for(a||(a=3),i||(i=0),r?f=Math.min(r*a+i,e.length):f=e.length,h=i;h<f;h+=a)t[0]=e[h],t[1]=e[h+1],t[2]=e[h+2],s(t,t,l),e[h]=t[0],e[h+1]=t[1],e[h+2]=t[2];return e}})();class ${constructor(e,a,i){this.gl=e;var r=this.gl.createShader(e.VERTEX_SHADER),s=this.gl.createShader(e.FRAGMENT_SHADER);if(this.gl.shaderSource(r,a),this.gl.shaderSource(s,i),this.gl.compileShader(r),!this.gl.getShaderParameter(r,e.COMPILE_STATUS)){console.error("ERROR compiling vertex shader!",e.getShaderInfoLog(r));return}if(this.gl.compileShader(s),!this.gl.getShaderParameter(s,e.COMPILE_STATUS)){console.error("ERROR compiling fragment shader!",e.getShaderInfoLog(s));return}if(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,r),this.gl.attachShader(this.program,s),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,e.LINK_STATUS)){console.log("ERROR linking program!",e.getProgramInfoLog(this.program));return}}}class Y{constructor(e,a){this.gl=e,this.id=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}}class Z{constructor(){if(this.canvas=document.querySelector("#webgl-canvas"),this.gl=this.canvas.getContext("webgl"),this.state={ui:{dragging:!1,mouse:{lastX:-1,lastY:-1}}},this.gl===null){alert("Unable to initialize WebGL. Your browser or machine may not support it.");return}this.init()}init(){this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.gl.cullFace(this.gl.BACK),this.clearGL()}clearGL(){this.gl.clearColor(.1,.1,.1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}async createShader(e,a){const r=await(await fetch(e)).text(),l=await(await fetch(a)).text();return new $(this.gl,r,l)}async createTexture(e){let a=await this.loadImagePath(e);return new Y(this.gl,a)}async createTextureFromUpload(e){let a=await this.loadImageFile(e);return new Y(this.gl,a)}loadImagePath(e){return new Promise(a=>{const i=new Image;i.onload=function(){a(i)},i.src=e})}loadImageFile(e){return new Promise(a=>{const i=new Image;var r=new FileReader;r.onload=function(){i.src=r.result,a(i)},r.readAsDataURL(e)})}drawObject(e){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e.indexBufferId),this.gl.bindTexture(this.gl.TEXTURE_2D,e.texture.id),this.gl.useProgram(e.shader.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.vertexBufferId);var a=this.gl.getAttribLocation(e.shader.program,"aPosition");this.gl.vertexAttribPointer(a,3,this.gl.FLOAT,this.gl.FALSE,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(a),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.texCoordsBufferId);var i=this.gl.getAttribLocation(e.shader.program,"aTexCoord");this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,this.gl.FALSE,2*Float32Array.BYTES_PER_ELEMENT,0*Float32Array.BYTES_PER_ELEMENT),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.normalBufferId);var r=this.gl.getAttribLocation(e.shader.program,"aNormal");this.gl.vertexAttribPointer(r,3,this.gl.FLOAT,this.gl.TRUE,3*Float32Array.BYTES_PER_ELEMENT,0),this.gl.enableVertexAttribArray(r);var s=new Float32Array(16),l=new Float32Array(16);C(l);var h=T();B(h,e.position.x,e.position.y,e.position.z),N(s,l,h),X(s,s,L(e.rotation.x)),W(s,s,L(e.rotation.y)),G(s,s,L(e.rotation.z));var f=this.gl.getUniformLocation(e.shader.program,"mWorld");this.gl.uniformMatrix4fv(f,this.gl.FALSE,s);var v=new Float32Array(16);V(v,[0,1,20],[0,0,0],[0,1,0]);var g=this.gl.getUniformLocation(e.shader.program,"mView");this.gl.uniformMatrix4fv(g,this.gl.FALSE,v);var n=new Float32Array(16);q(n,L(45),this.canvas.width/this.canvas.clientHeight,.1,100);var o=this.gl.getUniformLocation(e.shader.program,"mProj");this.gl.uniformMatrix4fv(o,this.gl.FALSE,n);var m=this.gl.getUniformLocation(e.shader.program,"flipTexX");this.gl.uniform1i(m,e.flipTexX);var p=this.gl.getUniformLocation(e.shader.program,"flipTexY");this.gl.uniform1i(p,e.flipTexY),this.gl.drawElements(this.gl.TRIANGLES,e.numIndices,this.gl.UNSIGNED_SHORT,0)}async parseObjFileFromUpload(e){return this.parseObj(e)}async parseObjFileFromPath(e){var a=await fetch(e);return this.parseObj(a)}async parseObj(e){var a=[],i=[],r=[],s=[],l=[],h=[],f=[],v=await e.text();v=v.split(`
`);var g=0;for(let o of v)if(o.startsWith("v ")){var n=o.split(" ");n.splice(0,1),l.push(n.map(m=>parseFloat(m)))}else if(o.startsWith("vt ")){var n=o.split(" ");n.splice(0,1),h.push(n.map(p=>parseFloat(p)))}else if(o.startsWith("vn ")){var n=o.split(" ");n.splice(0,1),f.push(n.map(p=>parseFloat(p)))}else if(o.startsWith("f ")){var n=o.split(" ");n.splice(0,1);const p=new RegExp("^((\\d+/){1}\\d+)$","g"),E=new RegExp("^((\\d+/){2}\\d+)$","g");if(p.test(n[0])){for(let c of n){let u=c.split("/");a=a.concat(l[u[0]-1]),i=i.concat(h[u[1]-1])}for(let c=1;c<=n.length-2;c++){s.push(0+g,c+g,c+1+g);let u=a.slice(0+g,0+g+3),R=T();B(R,u[0],u[1],u[2]);let y=a.slice(c+g,c+g+3),_=T();B(_,y[0],y[1],y[2]);let F=a.slice(c+1+g,c+1+g+3),S=T();B(S,F[0],F[1],F[2]);let U=T();O(U,_,R);let b=T();O(b,S,R);let M=T();K(M,U,b);let A=T();k(A,M),r.push(A[0],A[1],A[2]),r.push(A[0],A[1],A[2]),r.push(A[0],A[1],A[2])}}else if(E.test(n[0])){for(let c of n){let u=c.split("/");a=a.concat(l[u[0]-1]),i=i.concat(h[u[1]-1]),r=r.concat(f[u[2]-1])}for(let c=1;c<=n.length-2;c++)s.push(0+g,c+g,c+1+g)}g+=n.length}return{vertices:a,texCoords:i,normals:r,indices:s}}}let j=class{constructor(e,a,i,r){this.gl=e,this.shader=a,this.texture=i,this.setBuffers(r),this.rotation={x:0,y:0,z:0},this.position={x:0,y:0,z:0},this.flipTexX=!1,this.flipTexY=!1}setBuffers(e){var a=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices),this.gl.STATIC_DRAW);var i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e.vertices),this.gl.STATIC_DRAW);var r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e.texCoords),this.gl.STATIC_DRAW);var s=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e.normals),this.gl.STATIC_DRAW),this.indexBufferId=a,this.vertexBufferId=i,this.texCoordsBufferId=r,this.normalBufferId=s,this.numIndices=e.indices.length}setTexture(e){this.gl.deleteTexture(this.texture.id),this.texture=e}setModel(e){this.gl.deleteBuffer(this.indexBufferId),this.gl.deleteBuffer(this.vertexBufferId),this.gl.deleteBuffer(this.texCoordsBufferId),this.gl.deleteBuffer(this.normalBufferId),this.setBuffers(e)}setShader(e){this.shader=e}rotate(e,a){e=="x"&&(this.rotation.x+=a,this.rotation.x>=360&&(this.rotation.x=0)),e=="y"&&(this.rotation.y+=a,this.rotation.y>=360&&(this.rotation.y=0)),e=="z"&&(this.rotation.z+=a,this.rotation.z>=360&&(this.rotation.z=0))}};var d=new Z,I=await d.createShader("./shaders/default_vertex.glsl","./shaders/default_fragment.glsl"),J=await d.createShader("./shaders/white_vertex.glsl","./shaders/white_fragment.glsl"),Q=await d.createShader("./shaders/normals_vertex.glsl","./shaders/normals_fragment.glsl"),ee=await d.createShader("./shaders/toon_vertex.glsl","./shaders/toon_fragment.glsl"),te=await d.parseObjFileFromPath("./models/cube.obj"),re=await d.createTexture("./textures/white.png"),x=new j(d.gl,I,re,te),ie=document.querySelector("#model-input");ie.onchange=async t=>{var e=await d.parseObjFileFromUpload(t.target.files[0]);x.setModel(e)};var ae=document.querySelector("#texture-input");ae.onchange=async t=>{var e=await d.createTextureFromUpload(t.target.files[0]);x.setTexture(e)};let se=document.querySelectorAll(".texture-checkbox");se.forEach(function(t){t.addEventListener("change",function(e){e.target.id==="reverse-tex-x"?x.flipTexX=e.target.checked:e.target.id==="reverse-tex-y"&&(x.flipTexY=e.target.checked)})});let le=document.querySelectorAll(".shader-button");le.forEach(function(t){t.addEventListener("click",function(e){var a=I;e.target.id==="default-shader"?a=I:e.target.id==="white-shader"?a=J:e.target.id==="normals-shader"?a=Q:e.target.id==="toon-shader"&&(a=ee),x.setShader(a)})});let ne=document.querySelectorAll(".position-slider");ne.forEach(function(t){t.addEventListener("input",function(e){e.target.id==="x-slider"?(x.position.x=e.target.value,document.getElementById("x-output").innerHTML=e.target.value):e.target.id==="y-slider"?(x.position.y=e.target.value,document.getElementById("y-output").innerHTML=e.target.value):e.target.id==="z-slider"&&(x.position.z=e.target.value,document.getElementById("z-output").innerHTML=e.target.value)})});d.canvas.addEventListener("mousedown",function(t){var e=t.clientX,a=t.clientY,i=t.target.getBoundingClientRect();i.left<=e&&e<i.right&&i.top<=a&&a<i.bottom&&(d.state.ui.mouse.lastX=e,d.state.ui.mouse.lastY=a,d.state.ui.dragging=!0)});window.addEventListener("mouseup",function(t){d.state.ui.dragging=!1});d.canvas.addEventListener("mousemove",function(t){var e=t.clientX,a=t.clientY;if(d.state.ui.dragging){var i=300/d.canvas.height,r=i*(e-d.state.ui.mouse.lastX),s=i*(a-d.state.ui.mouse.lastY);x.rotate("x",s),x.rotate("y",r)}d.state.ui.mouse.lastX=e,d.state.ui.mouse.lastY=a});function he(t){const e=t.clientWidth,a=t.clientHeight,i=t.width!==e||t.height!==a;return i&&(t.width=e,t.height=a),i}let D=function(){he(d.gl.canvas),d.gl.viewport(0,0,d.gl.canvas.width,d.gl.canvas.height),d.clearGL(),d.drawObject(x),requestAnimationFrame(D)};D();
